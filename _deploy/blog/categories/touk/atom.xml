<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: touk | Marcin bloguje]]></title>
  <link href="http://zygm0nt.github.com/blog/categories/touk/atom.xml" rel="self"/>
  <link href="http://zygm0nt.github.com/"/>
  <updated>2012-10-17T08:55:01+02:00</updated>
  <id>http://zygm0nt.github.com/</id>
  <author>
    <name><![CDATA[Marcin Cylke]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Hadoop for Enterprises]]></title>
    <link href="http://zygm0nt.github.com/blog/2012/06/18/hadoop-for-enterprises/"/>
    <updated>2012-06-18T11:08:09+02:00</updated>
    <id>http://zygm0nt.github.com/blog/2012/06/18/hadoop-for-enterprises</id>
    <content type="html"><![CDATA[<div class='post'>
<p>Hadoop's usage as a big data processing framework gains a lot of attention lately. Now, not only big players see, that they can embrace the data their sites or products are generating and develop their businesses on it. For that to happen two things are needed: the data itself and means of processing really big amounts of it.  </p>

<p><span class="image-wrap" style=""><img src="http://blog.innovative-labs.com/blog/3488314950_453466f762_b.jpg" style="border: 0px solid black; width: 400px;" /></span></p>

<p>Gathering data is relatively easy. These are not necessarily structured data, you don't need to plan their usage at first. Just start collecting them and than you may experiment with their potential usage. If they'll come out as useless rubbish - deleting them won't be hard <img class="emoticon" src="http://zygm0nt.github.com/confluence/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> But imagine the values it may contribute to your business:</p>

<ul>
    <li>faster services - working on optimized data</li>
    <li>more clients - because of more relevant search results</li>
    <li>happy clients - your service can "read their minds" <img class="emoticon" src="http://zygm0nt.github.com/confluence/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></li>
    <li>etc.</li>
</ul>


<p>There are many companies that utilize Hadoop ecosystem for their own needs. You can read about some of them here: <a href="http://wiki.apache.org/hadoop/PoweredBy" class="external-link" rel="nofollow">http://wiki.apache.org/hadoop/PoweredBy</a> But since that page lacks insight into specific applications of Hadoop I've tried to delve into<br/>
details of how Hadoop helped tame some companies' big data sets.</p>

<EXCERPT>

<h2><a name="test-Facebook"></a>Facebook</h2>

<p>Being a social network provider, a widely used one, they require no introduction. However if you've lived under a rock for last couple years just visit their website <a href="http://facebook.com" class="external-link" rel="nofollow">http://facebook.com</a></p>

<p>Their main usage is data warehousing. Since they require to be able to access the data fast and reliably they had a need for real-time querying of their huge, and always growing data set. Their switch from MySQL databases was required due to the increasing workloads they experienced with standard databases. What they got "out of the box" with Hadoop was all the benefits of distributed file system (HDFS features). They expanded the ideas behind that even further and implemented truly Highly Available file system without Single Point of Failure.</p>

<p>Facebook has 3 interesting usage scenarios in which Hadoop plays a major role:</p>

<ul>
    <li>Titan - is Facebook's messaging system. It processes messages exchanged between users. Ensures that it happens fast and without glitches. Here Hadoop is used mainly as a huge, unlimited storage.</li>
    <li>Puma - Facebook Insights - a tool providing page statistics for  advanced Facebook users. Based on streams of data (clicks, likes, shares, comments and impressions) it graphs those data and makes it available near instantly.</li>
    <li>ODS - Operational Data Store - which stores Facebook's internal metrics - collections of OS and cluster health metrics. And it facilitates multiple accounting solutions.</li>
</ul>


<h2><a name="test-Twitter"></a>Twitter</h2>

<p>This popular micro-blogging platform, where you can register your account and follow friends and celebrities for their micro-messages does some pretty interesting things with their Hadoop cluster.</p>

<p>One of their motivations is to speed up their web-page's functionality. That is why the compute users' friendships in Twitter's social graph with Hadoop. Using connections between users they calculate their relationship to each other and estimate groups of users.</p>

<p>Since this service's users generate lots of content, the company conducts researches based on natural language processing. They probe what could be told about a user from his tweets. They use tweets' contents for advertisement purpose, trends analysis and many more.</p>

<p>From tweets and user's behaviours they characterise usage scenarios. Also, they gather usage statistics, like number of searches daily, number of tweets. Based on this seemingly irrelevant data they run comparisons of different types of users. Twitter analyzes data to determine whether mobile users, users who use third party clients or power users use Twitter differently from average users. Of course theses seem like really specific applications but nevertheless they are very original and base on the data that Twitter has been gathering for some time now. </p>

<h2><a name="test-EBay"></a>EBay</h2>

<p>Being the biggest auctioning site on the Internet, EBay uses Hadoop processing for increasing search relevance based on click-stream data, user data. This seems pretty obvious, considering their area of operation.</p>

<p>However the also have one other interesting thing - they try hard to automatically fill auctioned objects' metadata, based on the descriptions and other data provided by users. They employ data mining approach for this tasks and judging from their constant growth it seems to work <img class="emoticon" src="http://zygm0nt.github.com/confluence/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<h2><a name="test-LinkedIn"></a>LinkedIn</h2>

<p>Social network for professionals, thou a lot smaller than Facebook. Based on click-streams they discover relations between users. All the data concerning latest visits on your profile or people you may know from other places - this comes from Hadoop based analysis of those clicks people make all the time on their sites.</p>

<p>Also a very neat feature, called InMaps (<a href="http://inmaps.linkedinlabs.com/" class="external-link" rel="nofollow">http://inmaps.linkedinlabs.com/</a>) analyse declared schools and companies and generates data for graph with clustered friends of yours.</p>

<h2><a name="test-Last.fm"></a>Last.fm</h2>

<p>This on-line radio site, praised by many for its invaluable recommendations' system seems like a rather small and simple service. But behind the facade of simple web page there are lots of data being processed, so that their services could match a certain level of perfection.</p>

<p>Such large volume of their data comes from scrobbles. Each users of their service listening to a song generates a note about this fact - called scrobble. Based on that and user profiles they calculate global band popularity charts, maps of bands' popularity and many more usage statistics and timeline charts.</p>

<p><span class="image-wrap" style=""><img src="http://blog.innovative-labs.com/blog/7346959440_71648c9fe7_b.jpg" style="border: 0px solid black; width: 400px;" /></span></p>

<h2><a name="test-Conclusion"></a>Conclusion</h2>

<p>They just try to detect and trace new patterns in seemingly chaotic data sets. Perhaps you could also do the same? Analyze your data and expand your business value?</p></div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'><a href="http://www.wedding-cake-decorations.net">wedding cake decorations</a></div>
<div class='content'>
<p>We stumbled over here from a different web address and thought I might check things out.<br />
I like what I see so i am just following you.<br />
Look forward to checking out your web page yet again.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.car-floor-mats.net">rubber floor mats</a></div>
<div class='content'>
<p>I like what you guys are up too. This type of clever work and reporting!<br />
<br />
Keep up the awesome works guys I've added you guys to my own blogroll.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.bispioner.ru/phpBB3/memberlist.php?mode=viewprofile&amp;u=119586">Svayambhut Ghosh</a></div>
<div class='content'>
<p>Greetings from Florida! I'm bored at work so I decided to browse your site on my iphone during lunch break. I enjoy the info you present here and can't wait to take a look <br />
when I get home. I'm surprised at how quick your blog loaded on my cell phone .. I'm not even using WIFI, just 3G .<br />
. Anyways, very good site!</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.salethenorthfacejackets.com">north face jackets</a></div>
<div class='content'>
<p>Comfortableness &lt;a href=&quot;http://www.salethenorthfacejackets.com&quot;&gt;north face jackets&lt;/a&gt;<br />
is crucial when they get it that will &lt;a href=&quot;http://www.salethenorthfacejackets.com&quot;&gt;north face outlet&lt;/a&gt; get the best school bags pertaining to going camping &lt;a href=&quot;http://www.salethenorthfacejackets.com&quot;&gt;north face sale&lt;/a&gt;. Your easiest guarantee in the case of even larger delivers has become One with an inner metal framework, one that can wind &lt;a href=&quot;http://www.salethenorthfacejackets.com&quot;&gt;cheap north face&lt;/a&gt; up being aligned to help you appropriately fit your &lt;a href=&quot;http://www.salethenorthfacejackets.com/the-north-face-women-1&quot;&gt;north face women&lt;/a&gt; body. They should be now have http://www.salethenorthfacejackets.com secure which were wholly flexible, because essentially in the form of midsection belt to get more aid.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.plants-for-sale.com">plants sale</a></div>
<div class='content'>
<p>I never imagined how much stuff there was out there <br />
on this! Thanks for making it easy to get the picture</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.facebook.com/profile.php?id=100003406472249">gWgVcetqzVZukd</a></div>
<div class='content'>
<p>What Programming Languages Do Jobs Require? | Regular Geek  regulargeek.com/2009/07/21/what-programming-languages-do-jobs-require   view page   cahecd  As a software engineer, you need to keep your skills sharp and current. This is a general requirement of the job. In addition to this, in the current economy you do not want to be without a job. Obviously, this means learning more about what your current company uses for all of its development. What if you do not have a job or you are looking to leave? What technologies or programming languages should you be looking into?   From the page</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://businesses.wickedlocal.com/MA-Westford/Computer-Service-and-Repair/15">computer pc repair</a></div>
<div class='content'>
<p>Howdy are using Wordpress for your site platform? I'm new to the blog world but I'm trying to <br />
get started and create my own. Do you need any coding expertise to make your own <br />
blog? Any help would be greatly appreciated!</p></div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SoapUI ext libs and its weirdness]]></title>
    <link href="http://zygm0nt.github.com/blog/2011/11/02/soapui-ext-libs-and-its-weirdness/"/>
    <updated>2011-11-02T16:32:15+01:00</updated>
    <id>http://zygm0nt.github.com/blog/2011/11/02/soapui-ext-libs-and-its-weirdness</id>
    <content type="html"><![CDATA[<div class='post'>
<p>Suppose you want to add some additional jars to your SoapUI installation. It all should work ok if you put them in <b>bin/ext</b> directory. It is scanned at startup, and jars found there are automatically added to classpath.
</p>

<p>
However if you want to add some JDBC drivers, and happen to be using SoapUI version higher than 3.5.1 it is a bit more tricky.
</p>
<p>You may face this NoClassDefFoundError:<br/>

<pre>
An error occured [oracle/jdbc/Driver], see error log for details
java.lang.NoClassDefFoundError: oracle/jdbc/Driver
</pre>
</p> 

<p>
If so, try registering your drivers with <b>registerJdbcDriver</b> function, like I did in this snippet of code:
</p>
<div><script src='https://gist.github.com/1333768.js?file=jdbc-soapui.groovy'></script>
<noscript><pre><code>if (context.sql == null) {
	def driver = 'oracle.jdbc.OracleDriver'
	com.eviware.soapui.support.GroovyUtils.registerJdbcDriver( driver )
	def sql = Sql.newInstance('jdbc:oracle:thin:' + dbUri, driver)
	context.setProperty('sql', sql)
}</code></pre></noscript></div>



<p>What a crappy thing!</p></div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'><a href="http://podzastaw.org">Kelli</a></div>
<div class='content'>
<p>You can definitely see your expertise in the work you write.<br />
The world hopes for more passionate writers such as you who are not afraid to <br />
say how they believe. Always go after your heart.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.052b.com">Buford</a></div>
<div class='content'>
<p>It's going to be end of mine day, however before finish I am reading this fantastic paragraph to increase my experience.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.hotelfocus.com.pl">Chandra</a></div>
<div class='content'>
<p>My family every time say that I am wasting my time <br />
here at net, except I know I am getting knowledge every day by reading such pleasant articles.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.wayn.com/waynblog.html?wci=viewentry&amp;entry_key=265563">Florene</a></div>
<div class='content'>
<p>Thanks , I've just been looking for info approximately this topic for a long time and yours is the greatest I have found out till now. But, what concerning the bottom line? Are you positive in regards to the source?</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://www.hotelbookingwebsite.net">Myron</a></div>
<div class='content'>
<p>Nice post. I was checking continuously this blog and I am impressed!<br />
Extremely helpful information specially the last part <br />
:) I care for such information much. I was looking for this <br />
particular info for a long time. Thank you and best of luck.</p></div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What is NoSQL good for?]]></title>
    <link href="http://zygm0nt.github.com/blog/2011/09/21/what-is-nosql-good-for/"/>
    <updated>2011-09-21T23:12:34+02:00</updated>
    <id>http://zygm0nt.github.com/blog/2011/09/21/what-is-nosql-good-for</id>
    <content type="html"><![CDATA[<div class='post'>
<b>... or how I ended up writing a CouchDB proof of concept app?</b>

<p>Once upon a time I set out on a journey to discover the NoSQL land.
I've decided that doing simple queries wouldn't be interesting enough.
That's why I've chose to create an app that would be based on some NoSQL
database.</p>

<p>
The main idea was to create an app, that would dynamically update itself
with geographic data flowing in. Since there are myriads of geo-data
that are available on the internet, you can pick your favorite one and
load them into your SQL database of choice.
</p>

<EXCERPT>
<p>
In my case the primary source of data was a proprietary database, or more specifically - one table in it continuously updated with new data. To make that
data visible on my map I needed to:
</p>

<ul>
<li> buffer the huge amount of those records - so as not to overhoul
other services with large traffic, and not to flood the frontend</li>
<li> convert then to my representation</li>
<li> display them - have presentation layer in a browser - since
browser-based frontend was the easiest and fastest to develop</li>
</ul>

<p>
The idea of the front-end HTML page was to show new points on the map.
From the moment of opening the page records that appear in database
table should be shown interactively on the screen.
</p>

<h2>Toys used</h2>

<p>
For the first step I chose to use RabbitMQ broker. A queue on the broker would receive messages - one message per database table's row.
Then I'd use some simple groovy middle ware to convert the data to appropriate format and put it onto another db - this time db specific
to my app. 
</p>

<p>
You may ask why incorporate another database. It would be
good for separating environments - assuming the original data contains
some vulnerable content that should be anatomised, or we just don't feel
comfortable exposing the whole database of some XYZ-system just to have
access to its one table.
</p>

<p>
Since for my presentation layer I chose HTML+JS without any application server-based back-end I've decided on CouchDB . This seemed like
a perfect match for this scenario. Why? - ease of use, REST API, with JSON responses - just great for interacting with my simple front-end.
</p>

<p>
The flow of things was as shown on the image below:
</p>

<IMG src="http://blog.innovative-labs.com/blog/gmapper.png"
alt="diagram"/>

<h2>Avro - for the beginning</h2>
<p>
As you can see, I've chosen JSON as my data-format. I've been considering
<a href="http://avro.apache.org">Apache Avro</a> in the first place but
using it was a real pain in the ass. Avro itself is used in <a
href="http://hadoop.apache.org">Apache Hadoop</a> as a serialization
layer, so it would seem OK, but it has virtually <em>no
documentation</em>. But once you tear through the unintuitive interface
and manage to handle all those unthinkable exceptions you get a few pros
for this library. It's great in that it does not require code generation - I
like it being made on the fly. It also offers sending data in binary
format, which was not necessary, but never the less is a nice feature.
</p>

<p>
What I certainly didn't like about it was its orientation on the files
rather than chunks of data - so it was not so obvious how should I send
data through the wire. 
</p>

<p>
Than I found out it can produce JSON output, which would work for me,
except the output could not have been parsed by other JSON libraries :)
(<a
href="http://stackoverflow.com/questions/5375243/jcouchdb-svenson-unable-to-parse-json-string">I've
asked on stackoverflow about that, but with no luck</a>). 
</p>

<p>If my whining haven't put you back and still would like to see how to use Avro, try this unit
test in project's GitHub repo: <a
href="https://github.com/zygm0nt/gmapped/blob/master/feeder/src/test/groovy/pl/ftang/example/feeder/avro/AvroSimpleTest.groovy">AvroSimpleTest.groovy</a>
</p>


<h2>Svenson</h2>

<p>
I've dropped Avro in favour of a simple JSON lib called (<a
href="http://code.google.com/p/svenson/">Svenson</a> and that was
painless. The only thing I was forced to do was create my model class in
Java - the rest of the project is written in Groovy. I've no idea why
was that necessary, and didn't want to look into it.
</p>

<h2>RabbitMQ</h2>

<p>
Further on the way is <a href="http://www.rabbitmq.com/">RabbitMQ</a>, to which records are filled by a feeding
middle-ware written in Groovy. Since I use <a
href="http://activemq.apache.org">ActiveMQ</a> on a day-to-day basis,
I've decided to try something new. This broker is a really nice piece of
software. Being written in Erlang makes it really fast. What's more it
has some extensive capabilities and is easy to approach for anyone
similar with messaging (JMS and friends). For such a lightweight product
it is really powerful - implements AMQP! 
</p>

<h2>CouchDB</h2>

<p>
From the broker's queue messages are again fetched by a middle-ware just
to be put into <a href="http://couchdb.apache.org/">CouchDB</a> view.
This database is also written in Erlang. It's very reliable, however the
way it handles refreshing view isn't the most pleasant one -
performance-wise. 
</p>

<p>
Word of advice - if you're on Debian derivative, be cautious with
apt-repository version. It's rather _ancient_. Also remember to add
<b>allow_jsonp = true</b> to you config file
<i>/opt/couchbase/etc/couchdb/local.ini</i>. It's not enabled by
default, and not having this set would result with empty responses from
the CouchDB server.</p>

<p>The problem here is, that the browser doesn't allow quering a web server with hostname other than the one the script originates.
 More on this case <a
href="http://stackoverflow.com/questions/3386679/connection-ajax-couchdb-and-javascript">here</a>. Seems like my problem could be overcame by changing url in index.html and hostname couchdb listens on to the same address.
</p>

<p>
I've also created a view, that would expose an event by key: <a
href="https://github.com/zygm0nt/gmapped/blame/master/couchdb/by_date_view.js">view
code</a>
</p>

<h2>Presenting the dots</h2>

<p>
As a back-end I've done some JQuery based AJAX calls - nothing too
fancy. All things necessary for presentation layer are in <a
href="https://github.com/zygm0nt/gmapped/blob/master/index.html">this
file</a>.
</p>

<h2>Things to consider</h2>

<p>
Please bear in mind that this whole application is rather a playground,
not a full-fledged project!! After creating all the parts I have some
doubts about some architectural decisions I made. I don't think the
security have been taken into account seriously enough. Also scalability
was never an issue ;-)
</p>

<p>
If you have some thoughts about any of the aspects mentioned in this
post, please feel free to comment or contact me directly :)
</p>

<p>

And also you may try the application by yourself - it's on the <a
href="https://github.com/zygm0nt/gmapped">GitHub</a>.
</p></div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'><a href="http://mcl.jogger.pl">Marcin</a></div>
<div class='content'>
<p>@Piotrek, here is a link to JIRA ticket concerning this feature. I think it is being discussed ATM: https://issues.apache.org/jira/browse/COUCHDB-431</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://blog.koszulinski.pl">Piotrek Reinmar Koszuli≈Ñski</a></div>
<div class='content'>
<p>About Same Origin Policy - now there's Cross Origin Resource Sharing available in most of common browsers. It should help You if CouchDB has support for it.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://mcl.jogger.pl">Marcin</a></div>
<div class='content'>
<p>@klausa, thanks for your advice. I've made some changes to the post.</p></div>
</div>
<div class='comment'>
<div class='author'><a href="http://klausa.jogger.pl">klausa</a></div>
<div class='content'>
<p>&gt;The main idea was to create an app, that would dynamically update itself with geographic data flowing in. <br />
<br />
Not to nitpick, but that doesn't seem like an idea for app. I think you should explain what that displayed data is here.  If you moved your 'Presenting the dots' paragraph just above 'Toys used', it would be clear what do you wanted to do with this app.<br />
<br />
&gt;Also remember to add allow_jsonp = true to you config file /opt/couchbase/etc/couchdb/local.ini.<br />
<br />
I think you should explain what that option *really* does.<br />
<br />
Other than that, nice post!</p></div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OVal - validate your models quickly and effortlessly!]]></title>
    <link href="http://zygm0nt.github.com/blog/2011/07/14/oval-validate-your-models-quickly-and-effortlessly/"/>
    <updated>2011-07-14T10:25:19+02:00</updated>
    <id>http://zygm0nt.github.com/blog/2011/07/14/oval-validate-your-models-quickly-and-effortlessly</id>
    <content type="html"><![CDATA[<div class='post'>
<p>Some time ago one of the projects at work required me to validate
some Java POJOs. Theses were my model classes and I've been creating
them from incoming WebService requests. One would say that XSD would be
sufficient for the task, for parts of this validations - sure, it would.
But there were some advanced rules XSD would not handle, or would render
the schema document very complicated.</p>

<p>Rules I needed to express were like:

<ul>

<li>person's <i>first_name</i> and <i>last_name</i> should be of appropriate length -
between 2 and 20, and additionally one could pass a zero-length string
just to remove the previous value</li>
<li><i>state</i> field should consist only defined values - as in
dictionary value - this one would be completable with XSD's
enumerations, but would require often changing schema files and
redistributing them to interested parties :(</li>
</ul>

<p>The library I've decided to use for this task is <a
href="http://oval.sf.net">OVal</a> and it came out really nice! Read on
to find out the details!</p>

<EXCERPT>

<p>Oval is quite mature library that allows POJO validation, but is not
JSR303 (bean validation) implementation. It has converters that enable
it to understand those annotations, but I'm not sure about the
compatibility.</p>

<p>I've tried only a subset of the available checks, among which
were:</p>

<ul>
<li>NotNull</li>
<li>NotEmpty</li>
<li>Length</li>
</ul>

<p>There are many more, and their attributes give interesting ways to
configure the validation process. But using them was rather easy and did
not require to much brainstorming. What I really needed were custom
checks. And in this area OVal shows it's strength. Implementing a check
is really easy.</p>

<p>I needed an annotation that would check a field against some values in
a dictionary. If field's value was in the given set, than the validation
would succeed, if not, an exception would be thrown. To accomplish this
task it is required to implement two classes: annotation class and check
class - called by the validation engine on a given field.</p>

<p>Let's start with our new annotation:</p>

<div><script src='https://gist.github.com/1077516.js?file=DictionaryValue.java'></script>
<noscript><pre><code>import net.sf.oval.configuration.annotation.Constraint;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD})
@Constraint(checkWith = DictionaryValueCheck.class)
public @interface DictionaryValue {
    /**
     * message to be used for the ConstraintsViolatedException
     *
     * @see ConstraintsViolatedException
     */
    String message() default &quot;constraint.DictionaryValue.violated&quot;;

    String file();
}</code></pre></noscript></div>
 

In the above snippet I've defined a check-annotation, that would be used like
this:

<div><script src='https://gist.github.com/1077516.js?file=sample.java'></script>
<noscript><pre><code>public class Address {
        ....
	@DictionaryValue(file = &quot;/validation/voivodeship.txt&quot;) String state;
        ....
}</code></pre></noscript></div>
 

You can pass <i>file</i> - containing dictionary values for this field.
There is also <i>message</i> field in the annotation which is an error
message returned by the validation engine of failed check - pretty
handy. And can be expressed in <i>.properties</i> file as:

<div><script src='https://gist.github.com/1077516.js?file=validation.properties'></script>
<noscript><pre><code>constraint.DictionaryValue.violated={context} is not among allowed dictionary values</code></pre></noscript></div>
 

<p>Placeholder, like <i>context</i>, will be replaced with correct values supplied by the
validation engine.</p>

Annotating a field is not enough. It is also needed to create a validator
for this kind of check. The name of the class is already defined in
<i>DictionaryValue</i> annotation, it is called
<i>DictionaryValueCheck</i> and I've done this check this way:

<div><script src='https://gist.github.com/1077516.js?file=DictionaryValueCheck.java'></script>
<noscript><pre><code>import net.sf.oval.Validator;
import net.sf.oval.configuration.annotation.AbstractAnnotationCheck;
import net.sf.oval.context.OValContext;
import net.sf.oval.exception.OValException;
import org.apache.commons.io.IOUtils;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
import java.util.regex.Pattern;

public class DictionaryValueCheck extends AbstractAnnotationCheck&lt;DictionaryValue&gt; {

    private Log log = LogFactory.getLog(DictionaryValueCheck.class);

    private String file;

    Map&lt;String, String&gt; dictionary;

    @Override
	public void configure(final DictionaryValue constraintAnnotation) {
		super.configure(constraintAnnotation);
		setFile(constraintAnnotation.file());
	}

    private void setFile(String file) {
        this.file = file;
        dictionary = loadDictionaryFrom(file);
        requireMessageVariablesRecreation();
    }

    private Map&lt;String, String&gt; loadDictionaryFrom(String file) {
        String fileStr;
        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
        try {
            fileStr = IOUtils.toString(this.getClass().getResourceAsStream(file));
        } catch (IOException e) {
            log.error(&quot;Error loading file: &quot;, e);
            return map;
        }
        for (String line : fileStr.split(&quot;\n&quot;)) {
            if (line.trim().length() == 0)
                continue;
            String[] tokens = line.split(&quot; &quot;, 2); // we want 2 substrings max
            if (tokens.length == 2)
                map.put(tokens[0], tokens[1]);
            if (tokens.length == 1)
                map.put(tokens[0], null);
        }
        return map;
    }

    public boolean isSatisfied(Object validatedObject, Object valueToValidate, OValContext context, Validator validator) throws OValException {
        if (valueToValidate == null)
            return true;
        return dictionary.containsKey(valueToValidate);
    }
}
</code></pre></noscript></div>


What this basically does is:
<ol>
<li>when <i>file</i> is set - read dictionary content from the file into
map</li>
<li>upon check request just lookup value in dictionary parsed from the
input file</li>
</ol>

<p>And that's it!</p>

<p>For me Oval is really great tool. With it at ones disposal it is extremely easy to create any
imaginable validation you need. This library is really easy to use and
offers lots of handy features.</p>

<p>But perhaps I'm reinventing the wheel and all this can be done easily
with some other library? Share Your opinion!</p>
</div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'><a href="http://mcl.jogger.pl">Marcin</a></div>
<div class='content'>
<p>Now that's a great question. I've forgotten to write about this, but OVal offers profiles, which you can disable or enable whenever you like. You set a profile for a specific annotation. In your case let's assume You have two operations: add and update. Your model has field annotated with @NotNull(profile=&quot;UPDATE&quot;), which means we don't want null values on it when updating. In _add_ operation you disable the profile called UPDATE, so the annotation is also disabled. When calling _update_ you enable the profile and the validation is performed. <br />
<br />
More on this here: http://oval.sourceforge.net/userguide.html#d4e561</p></div>
</div>
<div class='comment'>
<div class='author'><a href="">querial</a></div>
<div class='content'>
<p>Question:<br />
Say, we have an object with a primary key, that is mandatory (in the database), but described as AUTOINCREMENT. When client sends new object data, the primary key is obviously null, but we need to validate it for not-nullity in other cases.<br />
<br />
Doea OVal handle variations / directions of validation?</p></div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Geecon 2011 - day 2]]></title>
    <link href="http://zygm0nt.github.com/blog/2011/05/22/geecon-2011-day-2/"/>
    <updated>2011-05-22T18:39:31+02:00</updated>
    <id>http://zygm0nt.github.com/blog/2011/05/22/geecon-2011-day-2</id>
    <content type="html"><![CDATA[<div class='post'>
<p>And now for part 2 of my visit to Geecon 2011!</p>
<EXCERPT>
<h2>1. <a href="http://jim.webber.name/">Jim Webber</a> "Revisiting SOA for the 21st
century"</h2>

<p>Now this was awesome! Jim Webber, a former <a
href="http://www.thoughtworks.com/">ThoughtWorks</a> employee, now
Neo4j evangelist (in <a href="http://neotechnology.com/">Neotechnology</a>) described his views
on how SOA should look - according to him. This was presented
previously, on other occasions as his "Guerilla SOA" talk - generally he
advocated for REST based services, loose contracts (stating that WSDLs
are too verbose and code generation is evil).</p>

<p>Jim mentioned Martin Fowler's article on integration databases but I
couldn't find it anywhere - thou the topic looks interesting. He also
recommended <a
href="http://en.wikipedia.org/wiki/Behavior_Driven_Development">BDD</a> and exposing tests on the web for the end
user to use them as early as possible.</p>

<p> One big point he made his case with was <b>not relying on enterprise
software</b>. Simple tools can do much better job. He compared
implementing Web Services security (Secured SOAP over HTTP over TCP IP)
to REST based service accessed through <i>HTTPS</i> - basic and easily
testable with tools like <a href="http://curl.haxx.se/">curl</a>.</p>

<p>Great talk. One of the best!</p>

<h2>2. <a href="http://blog.staffannoteberg.com/">Staffan Noteberg</a> "Regex - the future
programming"</h2>

<p>I must confess, that this did not go too well. The whole talk was
well prepared and laid out but it lacked depth. It was pretty basic
introduction to regex. From the presentation's subject I was rather
prepared for some novel uses of regex - like for example: showing how to
filter big volume of data with simple regex or sth.</p>

<p>But the talk was fun, Staffan is a good speaker. He is also an author
of <a href="http://www.pomodorotechnique.com/"> pomodoro technique</a> book - I intend to read sth abut
this technique and this may be a nice start</p>

<h2>3. Bartosz Kowalewski "Is OSGI ready for wide
adoption?"</h2>

<p>If it comes to titles I tend to rely on them pretty heavily, however
strange it may seem. This time I also did - and the whole talk did not
give me a definitive answer to the stated question.</p>

<p>Sure, the presentation was informative, but it described some OSGI
specific, quite low level stuff. Of course, if you want to use OSGI -
even by leveraging application server with OSGI under the hood - you
should know a fair bit about the technology itself. Even thou the AS
does a good job of hiding OSGI container specifics from the developer,
in case of problems it's better to be well informed. All in all - the
talk gave too little information for me.</p>

<h2>4. <a href="http://www.jetbrains.com/company/people/Pech_Vaclav.html">Vaclav Pech</a> "Pick low hanging fruit"</h2>

<p><b>"Parallelism is not hard, multithreading is"</b> - this was the
key sentence of the presentation. The speaker showed how to introduce
concurrency into normal java/groovy code by sprinkling it with
concurrency powder. Easy enough! With <a
href="http://gpars.codehaus.org/">GPars</a> library he
showed:</p>

<ul>
<li>running processing tasks with thread pools</li>
<li>testing concurrent code</li>
<li>Fork/join Thread Pool - multiple thread queues (note to self:
fork/join is good for hierarchical problems)</li>
<li>low-hanging fruits:<br>

    <ul>
    <li>async calculations</li>
    <li>fork/join</li>
    <li>dataflow</li>
    <li>parallel collection processing</li>
    </ul>
</li>
<li>Actors are great - use <a
href="http://gpars.codehaus.org/">GPars</a> or <a href="http://akka.io/">Akka</a>,
is sufficient to use <i>@ActiveMethod</i> and <i>@ActiveObject</i>
annotations and Actors are usable in OO-world</li>
</ul>
</p>

<p> Good talk, well received!</p>

<h2>5. <a href="http://www.linkedin.com/in/antonarhipov">Anton Arhipov</a> "Bytecode for discriminating
developers"</h2>

<p>Technical introduction to the world of bytecode, jvm specification
details. I've drifted away to some other topics - really - can't recall
what this was all about.</p>

<h2>6. <a href="http://jroller.com/aalmiray/">Andreas Almiray</a> "Polyglot Programming"</h2>

<p>This was a nice talk covering Groovy, Scala and Closure. The whole
point of it was to show how cool it is to play with emerging JVM
languages. They are not only fun but also useful. What's more, they
bring freshness to java world, injecting it with some new paradigms and
methodologies. It is easier to incorporate new ideas into younger JVM
languages than to the mature Java.</p>

<h2>7. <a href="http://jim.webber.name/">Jim Webber</a> "A pragmatic introduction to
Neo4j"</h2>

<p>And Jim Webber again, this time with some <a href="http://neo4j.org/">Neo4j</a> evangelism. First
came some taxonomy information on NoSQL databases (Not Only SQL) as a
whole - than some specific examples of problems solvable with graph
databases - and Neo4j is a graph database. </p>

<p> Main points of Jim's talk were:
<ul>
<li>sharding a database is important for scalability</li>
<li>series data - should be OK to use Neo4j as their storage</li>
</ul>

<h2>Conclusion</h2>

<p>These were all the sessions I attended. On Saturday there was a
Hacker-garden, but neither I had time nor will to stay - the topics were
very interesting and I'd definitely like to experience such an event,
but after 2 days of continuous talks I was rather tired.</p>

<p>To sum up, 2011's Geecon was a great experience, with lots of
interesting talks and lots of new inspirations. Keep up the good work
guys!</p></div>


<h2>Comments</h2>


<div class='comments'>
</div>

]]></content>
  </entry>
  
</feed>
